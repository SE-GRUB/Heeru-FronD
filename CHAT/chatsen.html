<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>
  <body
    class="border border-primary"
    style="overflow-x: hidden; max-width: 100dvh"
  >
    <section class="container col-12">
      <div class="row justify-content-center" id="chatbox"></div>
    </section>
    <section class="fixed-bottom mt-3">
      <div class="col-12">
        <!-- textpoin -->
        <div class="p-0 row justify-content-center text-center">
          <div class="p-0 col-9">
            <textarea id="inputTEXTPOIN" class="form-control col-12"></textarea>
          </div>
          <div class="p-0 col-3">
            <button
              class="p-0 col-12 btn btn-success"
              style="height: -webkit-fill-available"
              id="tigerkirim"
            >
              SEND
            </button>
          </div>
        </div>
      </div>
    </section>
    <script>
      var consid = 1;
      var myid = 2;
      var targetid = 3;
      var sessionM = "";
      var tempate = `
            // Pengirim
            <div class="sender row justify-content-end">
            <div class="col-10 row text-end">
                <div class="col-10"></div>
                <div class="col-2"><strong>Me</strong></div>
                <div class="col-2"></div>
                <div class="col-10 text-end">Siang Daffa</div>
            </div>
            </div>

            // penerimaa
            <div class="replay row justify-content-start">
            <div class="col-10 row text-start">
                <div class="col-2"><strong>DAFFA</strong></div>
                <div class="col-10"></div>
                <div class="col-10 text-start">Hallo apa kabara?</div>
            </div>
            </div>
            `;

      var chatbox = document.getElementById("chatbox");

      //   https://enp.lahoras.my.id/chat/up?idconst=1&message=%22INI%20PESAN%20MASAUKNYA%22&idtarget=3
      function saveup(idconst, message, idtarget) {
        // https://enp.lahoras.my.id/chat/up?idconst=1&message=%22INI%20PESAN%20MASAUKNYA%22&idtarget=3
        var url = `https://enp.lahoras.my.id/chat/up?idconst=${idconst}&message=${message}&idtarget=${idtarget}`;
        fetch(url)
          .then((response) => response.json())
          .then((data) => {
            console.log(data);
          });
      }

      function addChat() {
        var isi = document.getElementById("inputTEXTPOIN").value;
        saveup(consid, isi, targetid);
        document.getElementById("inputTEXTPOIN").value = "";
        isi = `
        <div class="sender row justify-content-end">
          <div class="col-10 row text-end">
            <div class="col-10"></div>
            <div class="col-2"><strong>Me</strong></div>
            <div class="col-2"></div>
            <div class="col-10 text-end">${isi}</div>
          </div>
        </div>`;
        chatbox.innerHTML += isi;
      }

      async function dataachat() {
        var url = `https://enp.lahoras.my.id/chat/get?idconst=${consid}`;
        const response = await fetch(url);
        const data = await response.json();
        return data;
      }

      async function loadChat() {
        var pesan = await dataachat();
        console.log(pesan);
        chatbox2 = "";
        pesan.pesan.forEach((element) => {
          if (element.target_id != myid) {
            var isi = `
                    <div class="sender row justify-content-end">
                    <div class="col-10 row text-end">
                        <div class="col-10"></div>
                        <div class="col-2"><strong>Me</strong></div>
                        <div class="col-2"></div>
                        <div class="col-10 text-end">${element.Pesan}</div>
                    </div>
                    </div>`;
            chatbox2 += isi;
          } else {
            var isi = `
            <div class="replay row justify-content-start">
                <div class="col-10 row text-start">
                    <div class="col-2"><strong>${"SIKEATER"}</strong></div>
                    <div class="col-10"></div>
                    <div class="col-10 text-start">${element.Pesan}</div>
                </div>
            </div>
            `;
            chatbox2 += isi;
          }
        });
        chatbox.innerHTML = chatbox2;
      }

      setInterval(() => {
        loadChat();
      }, 1000);

      // add event listener
      document
        .getElementById("inputTEXTPOIN")
        .addEventListener("keyup", function (event) {
          if (event.key === "Enter") {
            addChat();
          }
        });
      document.getElementById("tigerkirim").addEventListener("click", addChat);
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
